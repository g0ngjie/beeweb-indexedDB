"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class BrowserDB{constructor(e,s,o,t){if(this.load=!1,!window.indexedDB)throw new Error("Current browser does not support");this.dbName=e,this.storeName=s,this.targetIndex=o,this.version=t,this.initDatabase().then(({ok:e,err:s,message:o})=>{if(!(this.load=e))throw console.error(s),new Error(o)})}initDatabase(){return new Promise(n=>{const e=indexedDB.open(this.dbName,this.version);e.onerror=e=>{n({ok:!1,err:e,message:`Database ${this.dbName} connection failed`})},e.onsuccess=e=>{this.dataBase=e.target.result,n({ok:!0,message:`Database ${this.dbName} connected successfully`})},e.onupgradeneeded=e=>{const s=e.target.result;if(!s.objectStoreNames.contains(this.storeName)){const t=s.createObjectStore(this.storeName,{keyPath:"_id",autoIncrement:!0});if(t.createIndex("_id","_id",{unique:!0}),"[object Object]"===Object.prototype.toString.call(this.targetIndex))for(const r in this.targetIndex){var o;Object.hasOwnProperty.call(this.targetIndex,r)&&(o=this.targetIndex[r],t.createIndex(r,r,{unique:o}))}n({ok:!0,message:`Datasheet ${this.storeName} created successfully`})}}})}openTransaction(){const e=this.dataBase.transaction(this.storeName,"readwrite");return e.objectStore(this.storeName)}getStoreNames(){var e,s=this.dataBase.objectStoreNames;const o=[];for(const t in s)Object.prototype.hasOwnProperty.call(s,t)&&(e=s[t],o.push(e));return o}create(t){return new Promise(s=>{const e=this.openTransaction(),o=e.add(t);o.onsuccess=e=>{e=e.target.result;s({ok:!0,data:e,message:"success"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}clear(){return new Promise(s=>{const e=this.openTransaction(),o=e.clear();o.onsuccess=()=>{s({ok:!0,message:"success"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}deleteById(t){return new Promise(s=>{const e=this.openTransaction(),o=e.delete(t);o.onsuccess=e=>{e=e.target.result;s({ok:!0,data:e,message:"success"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}updateById(s,r){return new Promise(o=>{const t=this.openTransaction(),e=t.get(s);e.onsuccess=e=>{e=e.target.result,e=Object.assign({_id:e._id},r);const s=t.put(e);s.onsuccess=e=>{e=e.target.result;o({ok:!0,message:"success",data:e})},s.onerror=e=>{o({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}},e.onerror=e=>{o({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}findById(t){return new Promise(s=>{const e=this.openTransaction(),o=e.get(t);o.onsuccess=e=>{e=e.target.result;s(e?{ok:!0,data:e,message:"success"}:{ok:!1,message:"not found"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}find(r,n){return new Promise(s=>{const e=this.openTransaction(),o=e.index(r),t=o.getAll(n);t.onsuccess=e=>{e=e.target.result;s({ok:!0,data:e,message:"success"})},t.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}findAll(){return new Promise(s=>{const e=this.openTransaction(),o=e.getAll();o.onsuccess=e=>{e=e.target.result;s({ok:!0,data:e,message:"success"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}findCount(){return new Promise(s=>{const e=this.openTransaction(),o=e.count();o.onsuccess=e=>{e=e.target.result;s({ok:!0,data:e,message:"success"})},o.onerror=e=>{s({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}findLimit(n=10){return new Promise(o=>{const e=this.openTransaction(),s=e.openCursor();let t=1,r=[];s.onsuccess=function(e){const s=e.target.result;if(s){if(r.push(s.value),!(t<n))return o({ok:!0,data:r,message:"success"});s.continue(),t++}else o({ok:!0,data:r,message:"success"})},s.onerror=e=>{o({ok:!1,message:null===(e=null===(e=null==e?void 0:e.target)||void 0===e?void 0:e.error)||void 0===e?void 0:e.message})}})}}exports.default=BrowserDB;